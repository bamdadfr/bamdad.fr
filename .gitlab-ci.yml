stages:
  - build
  - base_image_update
  - release

include:
  - remote: https://gitlab.com/bamdadsabbagh/gitlab-ci-templates/raw/master/templates/build_docker_master.gitlab-ci.yml
  - remote: https://gitlab.com/bamdadsabbagh/gitlab-ci-templates/raw/master/templates/docker_base_image_update.gitlab-ci.yml

build:
  stage: build
  extends: .build_docker_master
  only:
    - master
  except:
    - schedules

base_image_update:on-schedule:
  stage: base_image_update
  extends: .docker_base_image_update
  only:
    variables:
      - $JOB == "base_image_update"

release:on-schedule:
  stage: release
  image: node:latest
  only:
    variables:
      - $JOB == "release"
  before_script:
    - npm install -g semantic-release @semantic-release/gitlab
  script:
    - semantic-release